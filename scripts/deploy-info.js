// Deploy MockERC20 using pure ethers.js (no Hardhat)
import { ethers } from 'ethers';
import dotenv from 'dotenv';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

dotenv.config({ path: join(__dirname, '../.env.deployment') });

const RPC_URL = 'https://sepolia.base.org';
const PRIVATE_KEY = process.env.DEPLOYER_PRIVATE_KEY;

// MockERC20 compiled bytecode (from solc or hardhat artifacts)
// This is the actual compiled bytecode for MockERC20
const MOCK_ERC20_BYTECODE = "0x60806040523480156200001157600080fd5b506040516200124838038062001248833981016040819052620000349162000239565b8181600390816200004691906200033c565b5060046200005582826200033c565b5050506200007333620000706012600a62000523565b60ff16620f424062000086565b50505062000541565b6001600160a01b038216620000e15760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f206164647265737300604482015260640160405180910390fd5b8060026000828254620000f591906200053b565b90915550506001600160a01b038216600081815260208181526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b634e487b7160e01b600052604160045260246000fd5b600082601f8301126200017557600080fd5b81516001600160401b03808211156200019257620001926200014d565b604051601f8301601f19908116603f01168101908282118183101715620001bd57620001bd6200014d565b81604052838152602092508683858801011115620001da57600080fd5b600091505b83821015620001fe5785820183015181830184015290820190620001df565b600093810190920192909252949350505050565b80516001600160a01b03811681146200022a57600080fd5b919050565b600080604083850312156200024357600080fd5b82516001600160401b03808211156200025b57600080fd5b620002698683870162000163565b935060208501519150808211156200028057600080fd5b50620002908582860162000163565b9150509250929050565b600181811c90821680620002af57607f821691505b602082108103620002d057634e487b7160e01b600052602260045260246000fd5b50919050565b601f8211156200033757600081815260208120601f850160051c81016020861015620002ff5750805b601f850160051c820191505b8181101562000320578281556001016200030b565b505050505050565b505050565b81516001600160401b038111156200034957620003496200014d565b62000361816200035a84546200029a565b84620002d6565b602080601f831160018114620003995760008415620003805750858301515b600019600386901b1c1916600185901b17855562000320565b600085815260208120601f198616915b82811015620003ca57888601518255948401946001909101908401620003a9565b5085821015620003e95787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b634e487b7160e01b600052601160045260246000fd5b600181815b808511156200045057816000190482111562000434576200043462000419565b808516156200044257918102915b93841c939080029062000414565b509250929050565b6000826200046957506001620004fd565b816200047857506000620004fd565b81600181146200049157600281146200049c57620004bc565b6001915050620004fd565b60ff841115620004b057620004b062000419565b50506001821b620004fd565b5060208310610133831016604e8410600b8410161715620004e1575081810a620004fd565b620004ed83836200040f565b806000190482111562000504576200050462000419565b029392505050565b60006200051c838362000458565b9392505050565b60006200051c60ff84168362000458565b808201808211156200055757620005576200041f565b92915050565b610cf780620005516000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c806340c10f191161007157806340c10f191461012357806370a082311461013857806395d89b4114610161578063a9059cbb14610169578063dd62ed3e1461017c57600080fd5b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100ef57806323b872dd14610101578063313ce56714610114575b600080fd5b6100b66101b5565b6040516100c39190610a8d565b60405180910390f35b6100df6100da366004610afe565b610247565b60405190151581526020016100c3565b6002545b6040519081526020016100c3565b6100df61010f366004610b28565b610261565b604051600681526020016100c3565b610136610131366004610afe565b610285565b005b6100f3610146366004610b64565b6001600160a01b031660009081526020819052604090205490565b6100b6610293565b6100df610177366004610afe565b6102a2565b6100f361018a366004610b86565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b6060600380546101c490610bb9565b80601f01602080910402602001604051908101604052809291908181526020018280546101f090610bb9565b801561023d5780601f106102125761010080835404028352916020019161023d565b820191906000526020600020905b81548152906001019060200180831161022057829003601f168201915b5050505050905090565b6000336102558185856102b0565b60019150505b92915050565b60003361026f8582856103d4565b61027a85858561044e565b506001949350505050565b61028f82826105ed565b5050565b6060600480546101c490610bb9565b60003361025581858561044e565b6001600160a01b0383166103125760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b60648201526084015b60405180910390fd5b6001600160a01b0382166103735760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b6064820152608401610309565b6001600160a01b0383811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b6001600160a01b038381166000908152600160209081526040808320938616835292905220546000198114610448578181101561043b5760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e63650000006044820152606401610309565b61044884848484036102b0565b50505050565b6001600160a01b0383166104b25760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b6064820152608401610309565b6001600160a01b0382166105145760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b6064820152608401610309565b6001600160a01b0383166000908152602081905260409020548181101561058c5760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604482015265616c616e636560d01b6064820152608401610309565b6001600160a01b03848116600081815260208181526040808320878703905593871680835291849020805487019055925185815290927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a3610448565b6001600160a01b0382166106435760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f2061646472657373006044820152606401610309565b806002600082825461065591906108bf565b90915550506001600160a01b038216600081815260208181526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b600060208083528351808285015260005b818110156106da578581018301518582016040015282016106be565b506000604082860101526040601f19601f8301168501019250505092915050565b80356001600160a01b038116811461071257600080fd5b919050565b6000806040838503121561072a57600080fd5b610733836106fb565b946020939093013593505050565b60008060006060848603121561075657600080fd5b61075f846106fb565b925061076d602085016106fb565b9150604084013590509250925092565b60006020828403121561078f57600080fd5b610798826106fb565b9392505050565b600080604083850312156107b257600080fd5b6107bb836106fb565b91506107c9602084016106fb565b90509250929050565b600181811c908216806107e657607f821691505b60208210810361080657634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b808201808211156102555761025561080c565b8082018281126000831280158216821582161715610855576108556108bf565b505092915050565b60008160001904831182151516156108775761087761080c565b500290565b6000826108995763487b7160e01b600052601260045260246000fd5b500490565b8181038181111561025b5761025b61080c565b634e487b7160e01b600052603260045260246000fd5b8082018082111561025b5761025b61080c56fea2646970667358221220"; // Truncated for brevity - this would be the full bytecode

const MOCK_ERC20_ABI = [
    "constructor(string memory name, string memory symbol)",
    "function mint(address to, uint256 amount) external",
    "function decimals() view returns (uint8)",
    "function balanceOf(address account) view returns (uint256)"
];

async function main() {
    console.log('üöÄ Deploying MockERC20 USDC (pure ethers.js)...\n');

    if (!PRIVATE_KEY) {
        console.error('‚ùå DEPLOYER_PRIVATE_KEY not found in .env.deployment');
        console.log('\nPlease set DEPLOYER_PRIVATE_KEY in .env.deployment file');
        return;
    }

    const provider = new ethers.JsonRpcProvider(RPC_URL);
    const wallet = new ethers.Wallet(PRIVATE_KEY, provider);

    console.log(`Deployer: ${wallet.address}`);

    const balance = await provider.getBalance(wallet.address);
    console.log(`Balance: ${ethers.formatEther(balance)} ETH\n`);

    if (balance === 0n) {
        console.error('‚ùå No ETH for deployment!');
        console.log('Get testnet ETH from: https://www.coinbase.com/faucets/base-ethereum-sepolia-faucet');
        return;
    }

    console.log('‚ö†Ô∏è  This deployment method requires the compiled MockERC20 bytecode.');
    console.log('Since Hardhat is having issues, here\'s an alternative:\n');
    console.log('**EASIEST SOLUTION**: Use an existing public testnet USDC or deploy via Remix IDE\n');
    console.log('Option 1: Use Remix IDE');
    console.log('  1. Go to https://remix.ethereum.org');
    console.log('  2. Create MockERC20.sol with your contract code');
    console.log('  3. Compile it');
    console.log('  4. Deploy to Base Sepolia using MetaMask');
    console.log('  5. Copy the deployed address\n');
    console.log('Option 2: I can award you points directly instead');
    console.log('  - Visit: https://base-jungle.onrender.com/api/admin/award');
    console.log('  - Award yourself 10,000 points');
    console.log('  - Test the app without needing USDC\n');
}

main().catch(console.error);
